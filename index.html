<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DiscoSphere - CLUB IMMERSION</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/build/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@500;700&family=Syncopate:wght@700&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { 'tech': ['Rajdhani', 'sans-serif'], 'display': ['Syncopate', 'sans-serif'] },
                    colors: { 'cyber-black': '#050508', 'cyber-glass': 'rgba(10, 15, 30, 0.75)', 'cyber-blue': '#00f3ff' },
                    animation: { 'pulse-fast': 'pulse 0.5s cubic-bezier(0.4, 0, 0.6, 1) infinite' }
                }
            }
        }
    </script>

    <style>
        body {
            background-color: #000;
            color: #fff;
            overflow: hidden;
            font-family: 'Rajdhani', sans-serif;
        }

        /* AMBIANCE CLUB - FOND ANIMÉ */
        .club-bg {
            position: fixed; inset: 0; z-index: -1;
            background: radial-gradient(circle at 50% 50%, rgba(20, 0, 40, 0.2) 0%, #000 80%);
            animation: bg-pulse 4s infinite alternate;
        }
        @keyframes bg-pulse {
            0% { transform: scale(1); opacity: 0.8; }
            100% { transform: scale(1.1); opacity: 1; }
        }

        /* GLASS PANEL */
        .glass-panel {
            background: rgba(10, 10, 20, 0.7);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
        }

        /* HOLOGRAMME */
        .holo-frame {
            border: 1px solid rgba(0, 243, 255, 0.5);
            background: rgba(0, 5, 10, 0.9);
            box-shadow: 0 0 40px rgba(0, 243, 255, 0.2);
        }
        .scanline {
            width: 100%; height: 100%; position: absolute;
            background: linear-gradient(to bottom, transparent 50%, rgba(0, 255, 255, 0.05) 50%);
            background-size: 100% 4px; pointer-events: none; z-index: 10;
        }

        /* LASER BEAMS CSS (UI DECORATION) */
        .laser-ui {
            position: absolute; top: 0; width: 2px; height: 100%;
            background: linear-gradient(to bottom, transparent, #00f3ff, transparent);
            opacity: 0.3; animation: laser-scan 3s infinite ease-in-out;
        }
        @keyframes laser-scan { 0% { left: 0%; } 50% { left: 100%; } 100% { left: 0%; } }

        /* BOUTONS */
        .btn-neon {
            transition: all 0.3s; border: 1px solid rgba(255,255,255,0.2);
        }
        .btn-neon:hover, .btn-neon.active {
            background: rgba(255,255,255,0.1); border-color: currentColor; box-shadow: 0 0 15px currentColor;
        }
    </style>
</head>
<body>

    <div class="club-bg"></div>

    <div id="themeScreen" class="fixed inset-0 z-50 flex flex-col items-center justify-center bg-black/90 backdrop-blur-xl transition-all duration-700">
        <h1 class="font-display text-5xl md:text-8xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-blue-400 via-white to-purple-500 mb-2 animate-pulse">
            DISCO<span class="text-white">SPHERE</span>
        </h1>
        <p class="text-cyan-400 tracking-[0.5em] text-sm uppercase mb-12">Immersive Experience v3.0</p>

        <div class="grid grid-cols-2 md:grid-cols-5 gap-4 max-w-6xl px-4">
            <button onclick="selectTheme('neon')" class="btn-neon p-6 rounded-xl text-center border-purple-500 text-purple-400 hover:text-white">
                <i class="fas fa-bolt text-3xl mb-2"></i><br>NEON 80s
            </button>
            <button onclick="selectTheme('cyber')" class="btn-neon p-6 rounded-xl text-center border-cyan-500 text-cyan-400 hover:text-white">
                <i class="fas fa-microchip text-3xl mb-2"></i><br>CYBER
            </button>
            <button onclick="selectTheme('kpop')" class="btn-neon p-6 rounded-xl text-center border-pink-500 text-pink-400 hover:text-white">
                <i class="fas fa-heart text-3xl mb-2"></i><br>K-POP
            </button>
            <button onclick="selectTheme('noel')" class="btn-neon p-6 rounded-xl text-center border-red-500 text-red-400 hover:text-white">
                <i class="fas fa-gift text-3xl mb-2"></i><br>NOËL
            </button>
            <button onclick="toggleBirthdayMode()" class="btn-neon p-6 rounded-xl text-center border-yellow-500 text-yellow-400 hover:text-white">
                <i class="fas fa-birthday-cake text-3xl mb-2"></i><br>MY BIRTHDAY
            </button>
        </div>

        <div id="birthdayInputSection" class="hidden mt-8 w-full max-w-md bg-black/80 border border-yellow-500 p-6 rounded-2xl text-center">
            <h3 class="text-xl font-display text-yellow-400 mb-4">ENTREZ VOTRE ANNÉE</h3>
            <input type="number" id="userYear" class="w-full bg-transparent border-b-2 border-yellow-500 text-white text-center text-3xl outline-none mb-4 font-mono" placeholder="YYYY">
            <button onclick="startBirthdayMode()" class="w-full py-3 bg-yellow-500 text-black font-bold rounded hover:bg-white transition">LANCER LE HIT</button>
        </div>

        <button onclick="startExperience()" class="mt-12 px-12 py-4 rounded-full border border-white/30 text-white hover:bg-white hover:text-black transition-all tracking-widest font-bold">
            ENTRER DANS LA BOITE
        </button>
    </div>

    <div id="mainInterface" class="hidden fixed inset-0 z-0">
        <div id="canvasContainer" class="absolute inset-0 z-0"></div>
        <div class="laser-ui"></div> <div class="absolute top-0 w-full z-20 p-4 flex justify-center overflow-x-auto">
            <div id="yearFilters" class="glass-panel rounded-full px-4 py-2 flex gap-2"></div>
        </div>

        <div class="absolute top-4 left-4 z-20 hidden md:block">
            <div class="glass-panel p-4 rounded-lg w-64">
                <h3 class="text-xs text-gray-400 tracking-widest border-b border-white/10 pb-2 mb-2">AMBIANCE CONTROL</h3>
                <div class="flex justify-between text-sm"><span id="themeLabel">THEME</span> <span class="text-cyan-400 font-bold">ACTIVE</span></div>
                <div class="flex justify-between text-sm"><span id="videoCounter">VIDEOS</span> <span class="text-purple-400 font-bold">0</span></div>
            </div>
        </div>

        <div id="hologram" class="hidden absolute top-1/2 right-4 md:right-10 transform -translate-y-1/2 z-30 w-[90vw] md:w-[600px]">
            <div class="holo-frame p-1 relative rounded-lg overflow-hidden backdrop-blur-xl transition-all duration-500">
                <div class="scanline"></div>
                <div class="flex justify-between bg-black/50 px-4 py-2 border-b border-white/10">
                    <h3 id="holoTitle" class="font-display text-xs text-cyan-400 truncate w-3/4">LOADING...</h3>
                    <button onclick="closeHologram()" class="text-white hover:text-red-500"><i class="fas fa-times"></i></button>
                </div>
                <div class="relative aspect-video bg-black">
                    <div id="videoPlayer" class="w-full h-full"></div>
                </div>
                <div class="px-4 py-2 bg-black/80 flex justify-between items-center text-[10px] text-gray-400 font-mono">
                    <span id="holoYear">YEAR ----</span>
                    <span class="text-red-500 animate-pulse">● LIVE</span>
                </div>
            </div>
        </div>

        <div class="absolute bottom-8 w-full flex justify-center z-20 pointer-events-none">
            <div class="glass-panel rounded-full p-3 pointer-events-auto flex items-center gap-4">
                <button onclick="toggleRotation()" class="w-10 h-10 rounded-full hover:bg-white/10 flex items-center justify-center"><i class="fas fa-pause"></i></button>
                <button onclick="changeTheme()" class="px-6 py-2 rounded-full border border-white/20 hover:bg-white hover:text-black text-xs font-bold">MENU</button>
            </div>
        </div>
    </div>

    <script>
        // --- DATA ---
        const fullPlaylist = [
            {id: "3JWTaaS7LdU", title: "Bee Gees - Stayin' Alive", year: "1977", decade: "70s", color: "#FF6B6B", theme: "disco"},
            {id: "fNFzfwLM72c", title: "Queen - Bohemian Rhapsody", year: "1975", decade: "70s", color: "#4ECDC4", theme: "retro"},
            {id: "rY0WxgSXdEE", title: "ABBA - Dancing Queen", year: "1976", decade: "70s", color: "#FFD166", theme: "retro"},
            {id: "dQw4w9WgXcQ", title: "Rick Astley - Never Gonna Give You Up", year: "1987", decade: "80s", color: "#EF476F", theme: "neon"},
            {id: "Zi_XLOBDo_Y", title: "Michael Jackson - Billie Jean", year: "1983", decade: "80s", color: "#FFD166", theme: "neon"},
            {id: "PIb6AZdTr-A", title: "Cyndi Lauper - Girls Just Want to Have Fun", year: "1983", decade: "80s", color: "#bc13fe", theme: "neon"},
            {id: "CduA0TULnow", title: "Backstreet Boys - I Want It That Way", year: "1999", decade: "90s", color: "#EF476F", theme: "retro"},
            {id: "C-u5WLJ9Yk4", title: "Britney Spears - Baby One More Time", year: "1998", decade: "90s", color: "#118AB2", theme: "retro"},
            {id: "V0PisGe66mY", title: "Las Ketchup - Aserejé", year: "2002", decade: "90s", color: "#FF0000", theme: "summer"},
            {id: "kIDWgqDBNXA", title: "Christina Aguilera - Genie in a Bottle", year: "1999", decade: "90s", color: "#FF6B6B", theme: "retro"},
            {id: "CvBfHwUxHIk", title: "Rihanna - Umbrella", year: "2007", decade: "00s", color: "#EF476F", theme: "cyber"},
            {id: "4m1EFMoRFvY", title: "Beyoncé - Single Ladies", year: "2008", decade: "00s", color: "#118AB2", theme: "cyber"},
            {id: "OPf0YbXqDm0", title: "Mark Ronson ft. Bruno Mars - Uptown Funk", year: "2014", decade: "10s", color: "#EF476F", theme: "funk"},
            {id: "7-7knsP2n5w", title: "Shakira - La La La (Brazil 2014)", year: "2014", decade: "10s", color: "#FFD700", theme: "latino"},
            {id: "hcm55lU9knw", title: "Michel Teló - Ai Se Eu Te Pego", year: "2011", decade: "10s", color: "#00FF00", theme: "latino"},
            {id: "gset79KMmt0", title: "Sia - Snowman", year: "2017", decade: "10s", color: "#FFFFFF", theme: "pop"},
            {id: "4NRXx6U8ABQ", title: "The Weeknd - Blinding Lights", year: "2020", decade: "20s", color: "#EF476F", theme: "synth"},
            {id: "P3QS83ubhHE", title: "Stromae - Santé", year: "2021", decade: "20s", color: "#FF6B6B", theme: "pop"},
            {id: "aAkMkVFwAoo", title: "Mariah Carey - All I Want for Christmas", year: "1994", decade: "noel", color: "#ff0f39", theme: "noel"},
            {id: "E8gmARGvPlI", title: "Wham! - Last Christmas", year: "1984", decade: "noel", color: "#00ff00", theme: "noel"},
            {id: "9bZkp7q19f0", title: "PSY - GANGNAM STYLE", year: "2012", decade: "kpop", color: "#FF1493", theme: "kpop"},
            {id: "gdZLi9oWNZg", title: "BTS - Dynamite", year: "2020", decade: "kpop", color: "#FFD700", theme: "kpop"},
            {id: "IHNzOHi8sJs", title: "BLACKPINK - DDU-DU DDU-DU", year: "2018", decade: "kpop", color: "#FF1493", theme: "kpop"}
        ];

        const themes = {
            neon: { name: "NEON 80s", bg: 0x050510, laser: 0xbc13fe },
            cyber: { name: "CYBERPUNK", bg: 0x000510, laser: 0x00f3ff },
            kpop: { name: "K-POP", bg: 0x100005, laser: 0xff1493 },
            noel: { name: "NOËL", bg: 0x0a0000, laser: 0xff0000 }
        };

        // --- VARS ---
        let scene, camera, renderer, controls, raycaster, mouse;
        let sphereGroup, animatedMeshes = [], lasers = [], floorGrid;
        let currentTheme = 'neon';
        let isRotating = true;
        let activeVideoCount = 0;

        // --- INIT ---
        function selectTheme(t) { currentTheme = t; highlightBtn(t); }
        function highlightBtn(t) {
            document.querySelectorAll('.btn-neon').forEach(b => b.classList.remove('active', 'bg-white/20'));
            // Logic to highlight simple but functional
        }

        function startExperience() {
            document.getElementById('themeScreen').style.opacity = '0';
            setTimeout(() => {
                document.getElementById('themeScreen').style.display = 'none';
                document.getElementById('mainInterface').style.display = 'block';
                document.getElementById('themeLabel').innerText = themes[currentTheme].name;
                initThree();
                createFilters();
            }, 800);
        }

        function toggleBirthdayMode() {
            document.getElementById('birthdayInputSection').classList.toggle('hidden');
        }

        function startBirthdayMode() {
            const year = document.getElementById('userYear').value;
            // Simuler une trouvaille (dans un vrai cas, on ferait un fetch)
            startExperience();
            setTimeout(() => {
                playHologram({id: "dQw4w9WgXcQ", title: `HIT N°1 DE ${year}`, year: year}); // Rick Roll par défaut pour la démo
            }, 1000);
        }

        // --- THREE.JS ---
        function initThree() {
            scene = new THREE.Scene();
            scene.fog = new THREE.FogExp2(themes[currentTheme].bg, 0.02);
            
            camera = new THREE.PerspectiveCamera(60, window.innerWidth/window.innerHeight, 0.1, 100);
            camera.position.set(0, 2, 9);

            renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
            document.getElementById('canvasContainer').appendChild(renderer.domElement);

            controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.autoRotate = true;
            controls.autoRotateSpeed = 1.0;

            // LUMIÈRES DYNAMIQUES
            const ambient = new THREE.AmbientLight(themes[currentTheme].bg, 0.5);
            scene.add(ambient);
            
            // Spot principal (Boule disco)
            const spot = new THREE.PointLight(themes[currentTheme].laser, 2, 20);
            spot.position.set(5, 5, 5);
            scene.add(spot);

            // DANCE FLOOR
            createDanceFloor();
            // LASERS
            createLasers();
            // SPHERE
            createSphere();
            // PARTICULES
            createParticles();

            raycaster = new THREE.Raycaster();
            mouse = new THREE.Vector2();
            
            window.addEventListener('resize', onResize);
            window.addEventListener('click', onClick);
            window.addEventListener('mousemove', onMove);

            animate();
        }

        function createDanceFloor() {
            // Grille brillante au sol
            const grid = new THREE.PolarGridHelper(20, 16, 8, 64, themes[currentTheme].laser, 0x222222);
            grid.position.y = -4;
            scene.add(grid);
            floorGrid = grid;
        }

        function createLasers() {
            // Création de 4 lasers qui tournent
            const geometry = new THREE.CylinderGeometry(0.05, 0.05, 30);
            const material = new THREE.MeshBasicMaterial({ 
                color: themes[currentTheme].laser, 
                transparent: true, 
                opacity: 0.3,
                blending: THREE.AdditiveBlending 
            });

            for(let i=0; i<6; i++) {
                const laser = new THREE.Mesh(geometry, material);
                laser.position.set(0, -4, 0);
                laser.rotation.z = Math.PI / 2; // Coucher
                laser.rotation.y = (Math.PI * 2 / 6) * i;
                // Pivot object
                const pivot = new THREE.Group();
                pivot.add(laser);
                scene.add(pivot);
                lasers.push({mesh: pivot, speed: (Math.random() - 0.5) * 0.05});
            }
        }

        function createSphere() {
            sphereGroup = new THREE.Group();
            scene.add(sphereGroup);

            let list = fullPlaylist;
            if(currentTheme === 'noel') list = fullPlaylist.filter(v => v.decade === 'noel');
            else if(currentTheme === 'kpop') list = fullPlaylist.filter(v => v.decade === 'kpop');
            else list = fullPlaylist.filter(v => v.decade !== 'noel' && v.decade !== 'kpop');

            const loader = new THREE.TextureLoader();
            loader.crossOrigin = "anonymous";

            // Fibonacci Sphere
            const count = 120;
            const radius = 3.5;

            for(let i=0; i<count; i++) {
                const phi = Math.acos(-1 + (2*i)/count);
                const theta = Math.sqrt(count * Math.PI) * phi;
                const x = radius * Math.cos(theta) * Math.sin(phi);
                const y = radius * Math.sin(theta) * Math.sin(phi);
                const z = radius * Math.cos(phi);

                const data = list[i % list.length];
                const geo = new THREE.PlaneGeometry(0.6, 0.45);
                
                // Texture Frame 1
                const tex = loader.load(`https://img.youtube.com/vi/${data.id}/1.jpg`);
                const mat = new THREE.MeshBasicMaterial({ map: tex, side: THREE.DoubleSide });

                const mesh = new THREE.Mesh(geo, mat);
                mesh.position.set(x,y,z);
                mesh.lookAt(x*2, y*2, z*2);
                mesh.userData = { id: data.id, title: data.title, year: data.year, decade: data.decade };

                sphereGroup.add(mesh);
                animatedMeshes.push(mesh);
            }
        }

        function createParticles() {
            const count = 500;
            const pos = new Float32Array(count * 3);
            for(let i=0; i<count*3; i++) pos[i] = (Math.random()-0.5)*30;
            const geo = new THREE.BufferGeometry();
            geo.setAttribute('position', new THREE.BufferAttribute(pos, 3));
            const mat = new THREE.PointsMaterial({ size: 0.1, color: 0xffffff, transparent: true });
            const p = new THREE.Points(geo, mat);
            scene.add(p);
        }

        // --- LOGIC ---
        function animate() {
            requestAnimationFrame(animate);
            controls.update();

            // Animation des lasers
            lasers.forEach(l => {
                l.mesh.rotation.y += l.speed;
                l.mesh.rotation.z = Math.sin(Date.now()*0.001) * 0.5; // Monte et descend
            });

            // Rotation du sol
            if(floorGrid) floorGrid.rotation.y += 0.002;

            // Rotation sphère
            if(isRotating && sphereGroup) {
                sphereGroup.rotation.y += 0.003;
                sphereGroup.rotation.x = Math.sin(Date.now()*0.0005)*0.2;
            }

            // Pulse Lights (BPM simulé)
            const pulse = 1 + Math.sin(Date.now() * 0.01) * 0.1;
            sphereGroup.scale.set(pulse, pulse, pulse);

            renderer.render(scene, camera);
        }

        function onResize() {
            camera.aspect = window.innerWidth/window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        function onMove(e) {
            mouse.x = (e.clientX/window.innerWidth)*2-1;
            mouse.y = -(e.clientY/window.innerHeight)*2+1;
            raycaster.setFromCamera(mouse, camera);
            const intersects = raycaster.intersectObjects(animatedMeshes);
            document.body.style.cursor = intersects.length > 0 ? 'pointer' : 'default';
        }

        function onClick(e) {
            if(e.target.closest('#hologram')) return;
            raycaster.setFromCamera(mouse, camera);
            const intersects = raycaster.intersectObjects(animatedMeshes);
            if(intersects.length > 0) playHologram(intersects[0].object.userData);
        }

        function playHologram(data) {
            activeVideoCount++;
            document.getElementById('videoCounter').innerText = activeVideoCount;
            const holo = document.getElementById('hologram');
            holo.classList.remove('hidden');
            
            document.getElementById('holoTitle').innerText = data.title;
            document.getElementById('holoYear').innerText = `YEAR ${data.year}`;
            
            document.getElementById('videoPlayer').innerHTML = `
                <iframe width="100%" height="100%" 
                src="https://www.youtube.com/embed/${data.id}?autoplay=1&modestbranding=1&rel=0" 
                frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe>`;
        }

        function closeHologram() {
            document.getElementById('hologram').classList.add('hidden');
            document.getElementById('videoPlayer').innerHTML = "";
        }

        function createFilters() {
            const container = document.getElementById('yearFilters');
            let tags = ['ALL', '70s', '80s', '90s', '00s', '10s', '20s'];
            if(currentTheme === 'noel') tags = ['NOËL CLASSICS'];
            if(currentTheme === 'kpop') tags = ['K-POP HITS'];

            tags.forEach(tag => {
                const btn = document.createElement('button');
                btn.className = "px-4 py-1 rounded-full bg-white/10 hover:bg-white/30 text-xs font-bold transition";
                btn.innerText = tag;
                btn.onclick = () => filterMeshes(tag);
                container.appendChild(btn);
            });
        }

        function filterMeshes(tag) {
            animatedMeshes.forEach(mesh => {
                if(tag === 'ALL' || tag === 'NOËL CLASSICS' || tag === 'K-POP HITS') mesh.visible = true;
                else mesh.visible = (mesh.userData.decade === tag);
            });
        }

        function toggleRotation() {
            isRotating = !isRotating;
        }

        function changeTheme() {
            location.reload();
        }
    </script>
</body>
</html>
